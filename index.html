<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Tagalog Dictionary Scraper</title>
  </head>

  <body>
    <pre id="content"></pre>
  </body>

  <script>
    fetch(
      "https://raw.githubusercontent.com/raymelon/tagalog-dictionary-scraper/master/tagalog_dict.txt"
    )
      .then((res) => {
        if (res.ok) {
          console.log(res);
          return res.text();
        } else {
          throw "res not ok";
        }
      })
      .then((data) => {
        let transformedData = data;

        let queryString = location.search;
        let params = new URLSearchParams(queryString);

        let as = params.get("as");
        let lineNo = params.get("lineNo");

        if (!data) {
          switch (as) {
            case "raw":
            case "csv":
            default:
              transformedData = "No data";
              break;

            case "json":
              transformedData = JSON.stringify({ msg: "No data" });
              break;
          }
        } else {
          data = data.trim();

          switch (as) {
            case "raw":
              transformedData = data;
              break;

            case "csv":
              transformedData = !lineNo
                ? data
                    .split("\n")
                    .map((ln, i) => `${i + 1}, ${ln},\n`)
                    .join("")
                    .slice(0, -2) // remove last character ',\n'
                : data.replaceAll("\n", ",\n");
              break;

            case "json":
            default:
              transformedData = lineNo
                ? JSON.stringify(
                    {
                      data: data
                        .split("\n")
                        .map((ln, i) => ({ line: i + 1, word: ln })),
                    },
                    null,
                    2
                  )
                : JSON.stringify(
                    {
                      data: data.split("\n"),
                    },
                    null,
                    2
                  );
              break;
          }
        }

        document.getElementById("content").innerHTML = transformedData;
      })
      .catch((e) => {
        console.error(e);

        let queryString = location.search;
        let params = new URLSearchParams(queryString);
        let as = params.get("as");

        switch (as) {
          case "raw":
          case "csv":
            messageOnError = "Error fetching data";
            break;

          case "json":
          default:
            messageOnError = JSON.stringify({ msg: "Error fetching data" });
            break;
        }

        document.getElementById("content").innerHTML = messageOnError;
      });
  </script>
</html>
